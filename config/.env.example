# Copy this file to .env and fill with real values for local development

# =============================================================================
# REQUIRED: Vast.ai Configuration
# =============================================================================
VASTAI_API_KEY=

# =============================================================================
# REQUIRED: Security
# =============================================================================
ADMIN_API_KEY=secure_admin_key_change_me
AUDIT_SALT=

# =============================================================================
# OPTIONAL: Model Download Tokens (for NSFW/gated models)
# =============================================================================
HUGGINGFACE_HUB_TOKEN=
CIVITAI_TOKEN=

# =============================================================================
# OPTIONAL: Custom Provisioning Script
# =============================================================================
# Set to URL of your custom script for auto-downloading models on instance boot
# Leave empty to use Vast.ai default provisioning
COMFYUI_PROVISION_SCRIPT=

# =============================================================================
# OPTIONAL: GPU Compatibility Settings
# =============================================================================
# Minimum CUDA compute capability for GPU selection (default: 7.0)
# - 6.1: GTX 1080 Ti, TITAN Xp (requires older PyTorch, NOT recommended)
# - 7.0: V100 (minimum recommended)
# - 7.5: RTX 2080 Ti, TITAN RTX
# - 8.0: A100
# - 8.6: RTX 3090, A4000, A5000
# - 8.9: RTX 4090, L40
# Set higher (e.g., 8.0) to only use newer GPUs, or lower to allow older hardware
VASTAI_MIN_CUDA_CAPABILITY=7.0

# Vast.ai ComfyUI image to use (default: vastai/comfy:v0.10.0-cuda-12.9-py312)
# Set to 'auto' to use the offer's default image
VASTAI_COMFY_IMAGE=

# =============================================================================
# OPTIONAL: Warm Pool Behavior
# =============================================================================
# Set to 1 to immediately terminate all instances (cost safety)
WARM_POOL_SAFE_MODE=0

# Minutes of idle time before auto-terminating instance (default: 15)
WARM_POOL_IDLE_MINUTES=15

# =============================================================================
# OPTIONAL: Server Configuration
# =============================================================================
PORT=3000

# =============================================================================
# DISCONNECTION ELIMINATION: 7-Layer Defense System
# See docs/DISCONNECTION_ELIMINATION_GUIDE.md for complete documentation
# =============================================================================

# ─────────────────────────────────────────────────────────────────────────────
# LAYER 1: SSH Connection Resilience
# ─────────────────────────────────────────────────────────────────────────────
# SSH retry limit - set to 999999 for effectively unlimited retries
SSH_MAX_CONSECUTIVE_FAILURES=999999

# SSH connection timeout in milliseconds
SSH_READY_TIMEOUT_MS=30000

# SSH keepalive ping interval in milliseconds
SSH_KEEPALIVE_INTERVAL_MS=10000

# Max missed keepalive pings before disconnect
SSH_KEEPALIVE_MAX_MISS=3

# ─────────────────────────────────────────────────────────────────────────────
# LAYER 2: Token Management
# ─────────────────────────────────────────────────────────────────────────────
# Token validation cache duration in milliseconds (5 minutes default)
TOKEN_VALIDATION_CACHE_MS=300000

# Periodic token validation interval in milliseconds (10 minutes default)
TOKEN_PERIODIC_CHECK_MS=600000

# Optional webhook URL for token validation alerts
TOKEN_ALERT_WEBHOOK=

# ─────────────────────────────────────────────────────────────────────────────
# LAYER 4: Connection Monitoring (ComfyUI Keepalive)
# ─────────────────────────────────────────────────────────────────────────────
# ComfyUI ping interval in milliseconds (30 seconds default)
COMFYUI_KEEPALIVE_INTERVAL_MS=30000

# ComfyUI ping timeout in milliseconds (5 seconds default)
COMFYUI_KEEPALIVE_TIMEOUT_MS=5000

# Max consecutive failures before triggering connection-lost alert
COMFYUI_KEEPALIVE_MAX_FAILURES=5

# ─────────────────────────────────────────────────────────────────────────────
# LAYER 5: Adaptive Polling
# ─────────────────────────────────────────────────────────────────────────────
# Polling interval when instance is starting/loading/leased (30 seconds default)
WARM_POOL_POLL_ACTIVE_INTERVAL_MS=30000

# Polling interval when instance is ready but idle (3 minutes default)
WARM_POOL_POLL_IDLE_INTERVAL_MS=180000

# Default polling interval fallback (2 minutes default)
WARM_POOL_POLL_INTERVAL_MS=120000

# ─────────────────────────────────────────────────────────────────────────────
# Additional Connection Settings
# ─────────────────────────────────────────────────────────────────────────────
# ComfyUI readiness timeout in milliseconds (15 minutes default)
COMFYUI_READY_TIMEOUT_MS=900000

# Disable auto-recovery of broken instances (set to 1 to disable)
DISABLE_AUTO_RECOVERY=0

# ─────────────────────────────────────────────────────────────────────────────
# SSH Tunnel Configuration (optional)
# ─────────────────────────────────────────────────────────────────────────────
# Use either REVERSE_SSH_DEST (user@host[:port]) or REVERSE_SSH_USER + REVERSE_SSH_HOST
# REVERSE_SSH_DEST=user@example.com[:22]   # full destination (user@host or user@host:port)
# REVERSE_SSH_USER=user                    # split form: user for reverse SSH
# REVERSE_SSH_HOST=example.com             # split form: host for reverse SSH
# REVERSE_SSH_KEY=/root/.ssh/id_rsa        # optional private key file for SSH auth
# REVERSE_TUNNEL_PORT_START=26700          # fallback remote port range start (inclusive)
# REVERSE_TUNNEL_PORT_END=26799            # fallback remote port range end (inclusive)