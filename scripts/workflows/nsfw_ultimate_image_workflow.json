{
  "_meta": {
    "title": "NSFW Ultimate Image Master Workflow",
    "description": "Elite NSFW image generation pipeline with comprehensive post-processing: FaceDetailer for facial enhancement, Ultimate SD Upscale for 4x quality improvement, and advanced conditioning. Produces professional-grade explicit content with maximum detail and quality.",
    "version": "1.0.0",
    "category": "ultimate-quality",
    "tags": ["ultimate", "facedetailer", "upscaling", "post-processing", "high-quality", "nsfw"],
    "author": "AI Kings Prototype",
    "date_created": "2024-01-26",
    "last_updated": "2024-01-26"
  },
  "model_requirements": {
    "base_model": {
      "name": "Pony Diffusion XL v1",
      "filename": "pmXL_v1.safetensors",
      "type": "checkpoint",
      "description": "High-quality Pony model for detailed NSFW generation",
      "url": "https://civitai.com/models/257749/pony-diffusion-v6-xl",
      "hash": "Expected hash for verification"
    },
    "upscale_model": {
      "name": "4x UltraSharp",
      "filename": "4x-UltraSharp.pth",
      "type": "upscale-model",
      "description": "High-quality 4x upscaling model for sharp, detailed enlargement",
      "url": "https://huggingface.co/uwg/upscaler",
      "hash": "Expected hash for verification"
    },
    "detection_models": {
      "face_detector": {
        "name": "YOLOv8 Face Detector",
        "filename": "face_yolov8m.pt",
        "type": "bbox-detector",
        "description": "Accurate face detection for FaceDetailer processing"
      },
      "sam_model": {
        "name": "SAM ViT-B",
        "filename": "sam_vit_b_01ec64.pth",
        "type": "sam-model",
        "description": "Segment Anything Model for precise face segmentation"
      }
    }
  },
  "quality_settings": {
    "base_resolution": {
      "width": 832,
      "height": 1216,
      "aspect_ratio": "2:3 (portrait optimized)"
    },
    "final_resolution": {
      "width": 1664,
      "height": 2432,
      "upscale_factor": "2x (from FaceDetailer) + 2x (from Ultimate Upscale) = 4x total",
      "target_resolution": "Up to 2048x3072 depending on settings"
    },
    "sampling": {
      "steps": 30,
      "cfg_scale": 7.0,
      "sampler": "dpmpp_2m_sde",
      "scheduler": "karras",
      "clip_skip": -2,
      "face_detail_steps": 20,
      "upscale_steps": 20
    },
    "performance": {
      "vram_usage": "~16-24GB",
      "recommended_gpu": "RTX 3090+ or equivalent",
      "generation_time": "~2-4 minutes",
      "processing_stages": "Base generation + Face detail + Upscaling"
    }
  },
  "post_processing_pipeline": {
    "face_enhancement": {
      "detector": "YOLOv8m for face detection",
      "segmentation": "SAM ViT-B for precise face masking",
      "refinement": "Inpainting with base model at 384x1024 resolution",
      "strength": "0.4 denoising strength for natural enhancement"
    },
    "upscaling": {
      "model": "4x-UltraSharp for sharp, detailed enlargement",
      "method": "Ultimate SD Upscale with tile-based processing",
      "refinement": "Additional sampling during upscale (20 steps)",
      "denoising": "0.35 strength for quality enhancement"
    }
  },
  "prompting_guide": {
    "base_generation_prompts": {
      "positive": "score_9, score_8_up, score_7_up, source_anime, rating_explicit, 1girl, beautiful detailed face, beautiful detailed eyes, high quality, nsfw, masterpiece, best quality, photorealistic, cinematic lighting",
      "negative": "score_6, score_5, score_4, source_pony, source_furry, low quality, worst quality, blurry, censored, watermark, ugly, bad anatomy, deformed, extra limbs, bad hands, bad fingers"
    },
    "face_detailer_prompts": {
      "positive": "detailed face, sharp eyes, high quality, masterpiece",
      "negative": "blurry, deformed, ugly, messy, bad anatomy, low quality"
    },
    "prompting_strategy": {
      "base_focus": "Overall composition and body in main prompts",
      "face_focus": "Facial details and quality in FaceDetailer prompts",
      "consistency": "Maintain style consistency across all prompt stages",
      "quality_emphasis": "Multiple quality tags for maximum detail extraction"
    }
  },
  "workflow_flow": {
    "stage_1_base_generation": "Generate base image (832x1216) with Pony XL",
    "stage_2_face_detection": "Detect faces using YOLOv8 and SAM segmentation",
    "stage_3_face_enhancement": "Inpaint and enhance facial details with FaceDetailer",
    "stage_4_upscaling": "4x upscale with Ultimate SD Upscale and UltraSharp model",
    "stage_5_final_output": "Save ultra-high quality NSFW image (up to 2048x3072)"
  },
  "expected_output": {
    "image_quality": "Professional-grade NSFW images with exceptional detail",
    "facial_quality": "Enhanced facial features with sharp eyes and detailed skin",
    "resolution": "1664x2432 to 2048x3072 pixels (4x total upscale)",
    "processing_artifacts": "Minimal to none due to advanced post-processing",
    "style_consistency": "Maintained across base generation and enhancement stages"
  },
  "advanced_configuration": {
    "face_detailer_settings": {
      "bbox_threshold": 0.4,
      "bbox_dilation": 0,
      "bbox_crop_factor": 1,
      "sam_detection_hint": "Use 'face' for best results",
      "sam_dilation": 0,
      "sam_threshold": 0.4,
      "sam_bbox_expansion": 0,
      "sam_mask_hint_threshold": 0.7,
      "sam_mask_hint_use_negative": "Use 'Guess' mode"
    },
    "ultimate_upscale_settings": {
      "upscale_by": 2.0,
      "seed": 1,
      "steps": 20,
      "cfg": 7.0,
      "sampler": "dpmpp_2m",
      "scheduler": "karras",
      "denoise": 0.35,
      "tile_width": 512,
      "tile_height": 0,
      "mask_blur": 8,
      "tile_padding": 32,
      "seam_fix_mode": 2,
      "seam_fix_denoise": 1,
      "seam_fix_width": 64,
      "seam_fix_mask_blur": 4,
      "seam_fix_padding": 16
    }
  },
  "troubleshooting": {
    "face_detection_failures": {
      "solution": "Adjust bbox_threshold lower (0.3-0.4), ensure clear facial features",
      "alternative": "Use different face detector model if available"
    },
    "upscaling_artifacts": {
      "solution": "Increase tile_padding, adjust denoise strength (0.3-0.4)",
      "alternative": "Use smaller upscale factor (1.5x) for problem images"
    },
    "vram_issues": {
      "solution": "Reduce tile_width to 256, use --lowvram flag",
      "alternative": "Process in stages or use CPU for upscaling"
    },
    "inconsistent_faces": {
      "solution": "Strengthen face detailer prompts, increase denoising slightly",
      "alternative": "Use higher base resolution before upscaling"
    }
  },
  "optimization_tips": {
    "performance": "Use FP16 precision and appropriate tile sizes for VRAM efficiency",
    "quality": "Fine-tune face detailer settings for specific facial features",
    "consistency": "Maintain prompt consistency across all processing stages",
    "batch_processing": "Process similar images together for efficient face detection"
  },
  "last_node_id": 101,
  "last_link_id": 104,
  "nodes": [
    {
      "id": 1,
      "type": "CheckpointLoaderSimple",
      "pos": [50, 100],
      "size": [315, 98],
      "outputs": [
        {"name": "MODEL", "type": "MODEL", "links": [1, 21, 31], "slot_index": 0},
        {"name": "CLIP", "type": "CLIP", "links": [100], "slot_index": 1},
        {"name": "VAE", "type": "VAE", "links": [6, 23, 33], "slot_index": 2}
      ],
      "widgets_values": ["pmXL_v1.safetensors"]
    },
    {
      "id": 99,
      "type": "CLIPSetLastLayer",
      "pos": [50, 250],
      "size": [315, 58],
      "inputs": [{"name": "clip", "type": "CLIP", "link": 100}],
      "outputs": [{"name": "CLIP", "type": "CLIP", "links": [2, 3, 22, 101, 102], "slot_index": 0}],
      "widgets_values": [-2]
    },
    {
      "id": 2,
      "type": "CLIPTextEncode",
      "pos": [400, 50],
      "size": [400, 100],
      "inputs": [{"name": "clip", "type": "CLIP", "link": 2}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [4, 34], "slot_index": 0}],
      "widgets_values": ["score_9, score_8_up, score_7_up, source_anime, rating_explicit, 1girl, beautiful detailed face, beautiful detailed eyes, high quality, nsfw, masterpiece, best quality, photorealistic, cinematic lighting"]
    },
    {
      "id": 3,
      "type": "CLIPTextEncode",
      "pos": [400, 200],
      "size": [400, 100],
      "inputs": [{"name": "clip", "type": "CLIP", "link": 3}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [5, 35], "slot_index": 0}],
      "widgets_values": ["score_6, score_5, score_4, source_pony, source_furry, low quality, worst quality, blurry, censored, watermark, ugly, bad anatomy, deformed, extra limbs, bad hands, bad fingers"]
    },
    {
      "id": 100,
      "type": "CLIPTextEncode",
      "pos": [1200, 550],
      "size": [400, 100],
      "inputs": [{"name": "clip", "type": "CLIP", "link": 101}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [50], "slot_index": 0}],
      "widgets_values": ["detailed face, sharp eyes, high quality, masterpiece"]
    },
    {
      "id": 101,
      "type": "CLIPTextEncode",
      "pos": [1200, 700],
      "size": [400, 100],
      "inputs": [{"name": "clip", "type": "CLIP", "link": 102}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [51], "slot_index": 0}],
      "widgets_values": ["blurry, deformed, ugly, messy, bad anatomy, low quality"]
    },
    {
      "id": 4,
      "type": "EmptyLatentImage",
      "pos": [400, 350],
      "size": [315, 106],
      "outputs": [{"name": "LATENT", "type": "LATENT", "links": [7], "slot_index": 0}],
      "widgets_values": [832, 1216, 1]
    },
    {
      "id": 5,
      "type": "KSampler",
      "pos": [850, 100],
      "size": [315, 262],
      "inputs": [
        {"name": "model", "type": "MODEL", "link": 1},
        {"name": "positive", "type": "CONDITIONING", "link": 4},
        {"name": "negative", "type": "CONDITIONING", "link": 5},
        {"name": "latent_image", "type": "LATENT", "link": 7}
      ],
      "outputs": [{"name": "LATENT", "type": "LATENT", "links": [8], "slot_index": 0}],
      "widgets_values": [11223344, "randomize", 30, 7.0, "dpmpp_2m_sde", "karras", 1]
    },
    {
      "id": 6,
      "type": "VAEDecode",
      "pos": [1200, 100],
      "size": [210, 46],
      "inputs": [
        {"name": "samples", "type": "LATENT", "link": 8},
        {"name": "vae", "type": "VAE", "link": 6}
      ],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [20], "slot_index": 0}]
    },
    {
      "id": 10,
      "type": "UltralyticsDetectorProvider",
      "pos": [1200, 250],
      "size": [315, 100],
      "outputs": [{"name": "BBOX_DETECTOR", "type": "BBOX_DETECTOR", "links": [24], "slot_index": 0}],
      "widgets_values": ["face_yolov8m.pt"]
    },
    {
      "id": 11,
      "type": "SAMLoader",
      "pos": [1200, 400],
      "size": [315, 100],
      "outputs": [{"name": "SAM_MODEL", "type": "SAM_MODEL", "links": [25], "slot_index": 0}],
      "widgets_values": ["sam_vit_b_01ec64.pth"]
    },
    {
      "id": 12,
      "type": "FaceDetailer",
      "pos": [1600, 100],
      "size": [315, 500],
      "inputs": [
        {"name": "image", "type": "IMAGE", "link": 20},
        {"name": "model", "type": "MODEL", "link": 21},
        {"name": "clip", "type": "CLIP", "link": 22},
        {"name": "vae", "type": "VAE", "link": 23},
        {"name": "positive", "type": "CONDITIONING", "link": 50},
        {"name": "negative", "type": "CONDITIONING", "link": 51},
        {"name": "bbox_detector", "type": "BBOX_DETECTOR", "link": 24},
        {"name": "sam_model_opt", "type": "SAM_MODEL", "link": 25}
      ],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [32], "slot_index": 0}],
      "widgets_values": [384, 1024, 0.4, 20, 0.5, "randomize", "dpmpp_2m", "karras", 1, 0.4]
    },
    {
      "id": 13,
      "type": "UpscaleModelLoader",
      "pos": [1600, 650],
      "size": [315, 58],
      "outputs": [{"name": "UPSCALE_MODEL", "type": "UPSCALE_MODEL", "links": [36], "slot_index": 0}],
      "widgets_values": ["4x-UltraSharp.pth"]
    },
    {
      "id": 14,
      "type": "UltimateSDUpscale",
      "pos": [2000, 100],
      "size": [315, 600],
      "inputs": [
        {"name": "image", "type": "IMAGE", "link": 32},
        {"name": "model", "type": "MODEL", "link": 31},
        {"name": "positive", "type": "CONDITIONING", "link": 34},
        {"name": "negative", "type": "CONDITIONING", "link": 35},
        {"name": "vae", "type": "VAE", "link": 33},
        {"name": "upscale_model", "type": "UPSCALE_MODEL", "link": 36}
      ],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [40], "slot_index": 0}],
      "widgets_values": [2, 1024, 0.35, 20, "dpmpp_2m", "karras", 1, 512, 0, 1, 64, 32, 2, true, false]
    },
    {
      "id": 7,
      "type": "SaveImage",
      "pos": [2400, 100],
      "size": [315, 270],
      "inputs": [{"name": "images", "type": "IMAGE", "link": 40}],
      "widgets_values": ["aikings_ultimate"]
    }
  ],
  "links": [
    [1, 1, 0, 5, 0, "MODEL"],
    [100, 1, 1, 99, 0, "CLIP"],
    [2, 99, 0, 2, 0, "CLIP"],
    [3, 99, 0, 3, 0, "CLIP"],
    [101, 99, 0, 100, 0, "CLIP"],
    [102, 99, 0, 101, 0, "CLIP"],
    [4, 2, 0, 5, 1, "CONDITIONING"],
    [5, 3, 0, 5, 2, "CONDITIONING"],
    [6, 1, 2, 6, 1, "VAE"],
    [7, 4, 0, 5, 3, "LATENT"],
    [8, 5, 0, 6, 0, "LATENT"],
    [20, 6, 0, 12, 0, "IMAGE"],
    [21, 1, 0, 12, 1, "MODEL"],
    [22, 99, 0, 12, 2, "CLIP"],
    [23, 1, 2, 12, 3, "VAE"],
    [50, 100, 0, 12, 4, "CONDITIONING"],
    [51, 101, 0, 12, 5, "CONDITIONING"],
    [24, 10, 0, 12, 6, "BBOX_DETECTOR"],
    [25, 11, 0, 12, 7, "SAM_MODEL"],
    [31, 1, 0, 14, 1, "MODEL"],
    [32, 12, 0, 14, 0, "IMAGE"],
    [33, 1, 2, 14, 4, "VAE"],
    [34, 2, 0, 14, 2, "CONDITIONING"],
    [35, 3, 0, 14, 3, "CONDITIONING"],
    [36, 13, 0, 14, 5, "UPSCALE_MODEL"],
    [40, 14, 0, 7, 0, "IMAGE"]
  ],
  "version": 0.4
}